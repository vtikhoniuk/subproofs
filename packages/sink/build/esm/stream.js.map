{"version":3,"file":"stream.js","names":["Code","ConnectError","createPromiseClient","createRequest","Stream","StreamService","Data","Duration","Effect","Metric","Option","Predicate","Ref","Schedule","Sink","Metrics","RetryableStreamError","TaggedClass","FatalStreamError","createStream","connectTransport","substreamPackage","outputModule","startBlockNum","stopBlockNum","startCursor","productionMode","maxRetrySeconds","create","gen","_","requestActiveStartBlock","make","BigInt","currentCursor","some","none","metrics","forEach","response","size","toBinary","byteLength","incrementBy","MessageSizeBytes","case","kind","value","message","increment","DataMessageCount","DataMessageSizeBytes","block","Number","clock","number","timestamp","seconds","now","Date","set","HeadBlockNumber","HeadBlockTime","HeadBlockTimeDrift","UndoMessageCount","UndoMessageSizeBytes","ProgressMessageCount","ProgressMessageSizeBytes","totalProcessedBlocks","latestEndBlockPerStage","Map","jobsPerStage","job","runningJobs","processedBlocks","jobEndBlock","startBlock","prevEndBlock","get","stage","i","metric","tagged","ProgressMessageLastBlock","jobs","ProgressMessageRunningJobs","stagesModules","stages","entries","modules","j","range","completedRanges","length","endBlock","ProgressMessageLastContiguousBlock","ProgressMessageTotalProcessedBlocks","session","JSON","stringify","max_parallel_workers","String","maxParallelWorkers","resolved_start_block","resolvedStartBlock","trace_id","traceId","logInfo","logWarning","fail","cause","UnknownMessageCount","UnknownMessageSizeBytes","aquire","pipe","map","getOrUndefined","client","request","controller","AbortController","stream","fromAsyncIterable","blocks","signal","code","Unauthenticated","Canceled","InvalidArgument","acquireRelease","scope","exit","sync","abort","flatMap","tapSink","tap","cursor","lastValidCursor","unit","tapError","error","all","SubstreamsErrorCount","retry","exponential","millis","jittered","either","spaced","compose","elapsed","whileOutput","lessThanOrEqualTo","whileInput","isTagged","tapInput","unwrap"],"sources":["../../src/stream.ts"],"sourcesContent":[null],"mappings":"AAAA,SAASA,IAAI,EAAEC,YAAY,EAAkBC,mBAAmB,QAAQ,qBAAqB;AAC7F,SAASC,aAAa,QAAQ,kBAAkB;AAChD,SAAmDC,MAAM,IAAIC,aAAa,QAAQ,wBAAwB;AAC1G,SAASC,IAAI,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,MAAM,EAAEC,MAAM,EAAEC,SAAS,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,IAAI,EAAEV,MAAM,QAAQ,QAAQ;AAEvG,OAAO,KAAKW,OAAO,MAAM,cAAc;AAIvC,OAAM,MAAOC,oBAAqB,SAAQV,IAAI,CAACW,WAAW,CAAC,sBAAsB,CAG/E;AAEF,OAAM,MAAOC,gBAAiB,SAAQZ,IAAI,CAACW,WAAW,CAAC,kBAAkB,CAGvE;AAsDF,OAAM,SAAUE,YAAYA,CAAC;EAC3BC,gBAAgB;EAChBC,gBAAgB;EAChBC,YAAY;EACZC,aAAa;EACbC,YAAY;EACZC,WAAW;EACXC,cAAc;EACdC,eAAe,GAAG;AAAG,CACD;EACpB,MAAMC,MAAM,GAAGpB,MAAM,CAACqB,GAAG,CAAC,WAAWC,CAAC;IACpC,MAAMC,uBAAuB,GAAG,OAAOD,CAAC,CAAClB,GAAG,CAACoB,IAAI,CAACC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;IAC7D,MAAMC,aAAa,GAAG,OAAOJ,CAAC,CAAClB,GAAG,CAACoB,IAAI,CAACP,WAAW,GAAGf,MAAM,CAACyB,IAAI,CAASV,WAAW,CAAC,GAAGf,MAAM,CAAC0B,IAAI,EAAU,CAAC,CAAC;IAEhH,MAAMC,OAAO,GAAGvB,IAAI,CAACwB,OAAO,CAAEC,QAAkB,IAC9C/B,MAAM,CAACqB,GAAG,CAAC,WAAWC,CAAC;MACrB,MAAMU,IAAI,GAAGD,QAAQ,CAACE,QAAQ,EAAE,CAACC,UAAU;MAC3C,OAAOZ,CAAC,CAACrB,MAAM,CAACkC,WAAW,CAAC5B,OAAO,CAAC6B,gBAAgB,EAAEJ,IAAI,CAAC,CAAC;MAE5D,MAAM;QAAEK,IAAI,EAAEC,IAAI;QAAEC,KAAK,EAAEC;MAAO,CAAE,GAAGT,QAAQ,CAACS,OAAO;MAEvD,QAAQF,IAAI;QACV,KAAK,iBAAiB;UAAE;YACtB,OAAOhB,CAAC,CAACrB,MAAM,CAACwC,SAAS,CAAClC,OAAO,CAACmC,gBAAgB,CAAC,CAAC;YACpD,OAAOpB,CAAC,CAACrB,MAAM,CAACkC,WAAW,CAAC5B,OAAO,CAACoC,oBAAoB,EAAEX,IAAI,CAAC,CAAC;YAEhE;YACA,MAAMY,KAAK,GAAGC,MAAM,CAACL,OAAO,CAACM,KAAK,EAAEC,MAAM,IAAI,CAAC,CAAC;YAChD,MAAMC,SAAS,GAAGH,MAAM,CAACL,OAAO,CAACM,KAAK,EAAEE,SAAS,EAAEC,OAAO,IAAI,CAAC,CAAC;YAChE,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,EAAE,GAAG,IAAI;YAE7B,OAAO5B,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAAC7C,OAAO,CAAC8C,eAAe,EAAET,KAAK,CAAC,CAAC;YACpD,OAAOtB,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAAC7C,OAAO,CAAC+C,aAAa,EAAEN,SAAS,CAAC,CAAC;YACtD,OAAO1B,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAAC7C,OAAO,CAACgD,kBAAkB,EAAEL,GAAG,GAAGF,SAAS,CAAC,CAAC;YACjE;;QAGF,KAAK,iBAAiB;UAAE;YACtB,OAAO1B,CAAC,CAACrB,MAAM,CAACwC,SAAS,CAAClC,OAAO,CAACiD,gBAAgB,CAAC,CAAC;YACpD,OAAOlC,CAAC,CAACrB,MAAM,CAACkC,WAAW,CAAC5B,OAAO,CAACkD,oBAAoB,EAAEzB,IAAI,CAAC,CAAC;YAChE;;QAGF,KAAK,UAAU;UAAE;YACf,OAAOV,CAAC,CAACrB,MAAM,CAACwC,SAAS,CAAClC,OAAO,CAACmD,oBAAoB,CAAC,CAAC;YACxD,OAAOpC,CAAC,CAACrB,MAAM,CAACkC,WAAW,CAAC5B,OAAO,CAACoD,wBAAwB,EAAE3B,IAAI,CAAC,CAAC;YAEpE,IAAI4B,oBAAoB,GAAGnC,MAAM,CAAC,CAAC,CAAC;YACpC,MAAMoC,sBAAsB,GAAG,IAAIC,GAAG,EAAkB;YACxD,MAAMC,YAAY,GAAG,IAAID,GAAG,EAAkB;YAE9C,KAAK,MAAME,GAAG,IAAIxB,OAAO,CAACyB,WAAW,EAAE;cACrCL,oBAAoB,IAAII,GAAG,CAACE,eAAe;cAE3C,MAAMC,WAAW,GAAGH,GAAG,CAACI,UAAU,GAAGJ,GAAG,CAACE,eAAe;cACxD,MAAMG,YAAY,GAAGR,sBAAsB,CAACS,GAAG,CAACN,GAAG,CAACO,KAAK,CAAC,IAAI9C,MAAM,CAAC,CAAC,CAAC;cACvE,IAAI0C,WAAW,GAAGE,YAAY,EAAE;gBAC9BR,sBAAsB,CAACT,GAAG,CAACY,GAAG,CAACO,KAAK,EAAEJ,WAAW,CAAC;;cAGpDJ,YAAY,CAACX,GAAG,CAACY,GAAG,CAACO,KAAK,EAAE,CAACR,YAAY,CAACO,GAAG,CAACN,GAAG,CAACO,KAAK,CAAC,IAAI9C,MAAM,CAAC,CAAC,CAAC,IAAIA,MAAM,CAAC,EAAE,CAAC,CAAC;;YAGtF,KAAK,MAAM,CAAC+C,CAAC,EAAE5B,KAAK,CAAC,IAAIiB,sBAAsB,EAAE;cAC/C;cACA,MAAMY,MAAM,GAAGxE,MAAM,CAACyE,MAAM,CAACnE,OAAO,CAACoE,wBAAwB,EAAE,OAAO,EAAE,SAASH,CAAC,EAAE,CAAC;cACrF,OAAOlD,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAACqB,MAAM,EAAE5B,MAAM,CAACD,KAAK,CAAC,CAAC,CAAC;;YAG7C,KAAK,MAAM,CAAC4B,CAAC,EAAEI,IAAI,CAAC,IAAIb,YAAY,EAAE;cACpC;cACA,MAAMU,MAAM,GAAGxE,MAAM,CAACyE,MAAM,CAACnE,OAAO,CAACsE,0BAA0B,EAAE,OAAO,EAAE,SAASL,CAAC,EAAE,CAAC;cACvF,OAAOlD,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAACqB,MAAM,EAAE5B,MAAM,CAAC+B,IAAI,CAAC,CAAC,CAAC;;YAG5C,MAAMR,UAAU,GAAG,OAAO9C,CAAC,CAAClB,GAAG,CAACkE,GAAG,CAAC/C,uBAAuB,CAAC,CAAC;YAC7D,MAAMuD,aAAa,GAAG,IAAIhB,GAAG,EAAoB;YACjD,KAAK,MAAM,CAACU,CAAC,EAAED,KAAK,CAAC,IAAI/B,OAAO,CAACuC,MAAM,CAACC,OAAO,EAAE,EAAE;cACjDF,aAAa,CAAC1B,GAAG,CAACoB,CAAC,EAAED,KAAK,CAACU,OAAO,CAAC;cAEnC,KAAK,MAAM,CAACC,CAAC,EAAEC,KAAK,CAAC,IAAIZ,KAAK,CAACa,eAAe,CAACJ,OAAO,EAAE,EAAE;gBACxD;gBACA,IAAI9D,cAAc,IAAIsD,CAAC,KAAKhC,OAAO,CAACuC,MAAM,CAACM,MAAM,GAAG,CAAC,EAAE;kBACrD,IAAIjB,UAAU,IAAIe,KAAK,CAACf,UAAU,IAAIe,KAAK,CAACG,QAAQ,IAAIlB,UAAU,EAAE;oBAClE,MAAMK,MAAM,GAAGxE,MAAM,CAACyE,MAAM,CAACnE,OAAO,CAACgF,kCAAkC,EAAE,OAAO,EAAE,SAASf,CAAC,EAAE,CAAC;oBAC/F,OAAOlD,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAACqB,MAAM,EAAE5B,MAAM,CAACsC,KAAK,CAACG,QAAQ,CAAC,CAAC,CAAC;;iBAEvD,MAAM;kBACL,IAAIJ,CAAC,KAAK,CAAC,EAAE;oBACX,MAAMT,MAAM,GAAGxE,MAAM,CAACyE,MAAM,CAACnE,OAAO,CAACgF,kCAAkC,EAAE,OAAO,EAAE,SAASf,CAAC,EAAE,CAAC;oBAC/F,OAAOlD,CAAC,CAACrB,MAAM,CAACmD,GAAG,CAACqB,MAAM,EAAE5B,MAAM,CAACsC,KAAK,CAACG,QAAQ,CAAC,CAAC,CAAC;;;gBAIxD1B,oBAAoB,IAAIuB,KAAK,CAACG,QAAQ,GAAGH,KAAK,CAACf,UAAU;;;YAI7D;YACAnE,MAAM,CAACmD,GAAG,CAAC7C,OAAO,CAACiF,mCAAmC,EAAE3C,MAAM,CAACe,oBAAoB,CAAC,CAAC;YAErF;;QAGF,KAAK,SAAS;UAAE;YACd,MAAM6B,OAAO,GAAGC,IAAI,CAACC,SAAS,CAAC;cAC7BC,oBAAoB,EAAEC,MAAM,CAACrD,OAAO,CAACsD,kBAAkB,CAAC;cACxDC,oBAAoB,EAAEF,MAAM,CAACrD,OAAO,CAACwD,kBAAkB,CAAC;cACxDC,QAAQ,EAAEJ,MAAM,CAACrD,OAAO,CAAC0D,OAAO;aACjC,CAAC;YAEF,OAAO5E,CAAC,CAACtB,MAAM,CAACmG,OAAO,CAAC,4CAA4CV,OAAO,EAAE,CAAC,CAAC;YAC/E,OAAOnE,CAAC,CAAClB,GAAG,CAACgD,GAAG,CAAC7B,uBAAuB,EAAEiB,OAAO,CAACwD,kBAAkB,CAAC,CAAC;YACtE;;QAGF,KAAK,uBAAuB;QAC5B,KAAK,mBAAmB;UAAE;YACxB,OAAO1E,CAAC,CAACtB,MAAM,CAACoG,UAAU,CAAC,2EAA2E,CAAC,CAAC;YACxG;;QAGF,KAAK,YAAY;UAAE;YACjB,OAAO9E,CAAC,CACNtB,MAAM,CAACqG,IAAI,CACT,IAAI3F,gBAAgB,CAAC;cACnB8B,OAAO,EAAE,+CAA+C;cACxD8D,KAAK,EAAE9D;aACR,CAAC,CACH,CACF;YACD;;QAGF;UAAS;YACP,OAAOlB,CAAC,CAACtB,MAAM,CAACoG,UAAU,CAAC,+BAA+B,CAAC,CAAC;YAC5D,OAAO9E,CAAC,CAACrB,MAAM,CAACwC,SAAS,CAAClC,OAAO,CAACgG,mBAAmB,CAAC,CAAC;YACvD,OAAOjF,CAAC,CAACrB,MAAM,CAACkC,WAAW,CAAC5B,OAAO,CAACiG,uBAAuB,EAAExE,IAAI,CAAC,CAAC;YACnE;;;IAGN,CAAC,CAAC,CACH;IAED,MAAMyE,MAAM,GAAGrG,GAAG,CAACkE,GAAG,CAAC5C,aAAa,CAAC,CAACgF,IAAI,CACxC1G,MAAM,CAAC2G,GAAG,CAAE1F,WAAW,IAAKf,MAAM,CAAC0G,cAAc,CAAC3F,WAAW,CAAC,CAAC,EAC/DjB,MAAM,CAAC2G,GAAG,CAAE1F,WAAW,IAAI;MACzB,MAAM4F,MAAM,GAAGnH,mBAAmB,CAACG,aAAa,EAAEe,gBAAgB,CAAC;MACnE,MAAMkG,OAAO,GAAGnH,aAAa,CAAC;QAC5BkB,gBAAgB;QAChBK,cAAc;QACdJ,YAAY;QACZC,aAAa;QACbC,YAAY;QACZC;OACD,CAAC;MAEF,MAAM8F,UAAU,GAAG,IAAIC,eAAe,EAAE;MACxC,MAAMC,MAAM,GAAGrH,MAAM,CAACsH,iBAAiB,CAACL,MAAM,CAACM,MAAM,CAACL,OAAO,EAAE;QAAEM,MAAM,EAAEL,UAAU,CAACK;MAAM,CAAE,CAAC,EAAGd,KAAK,IAAI;QACvG,IAAIA,KAAK,YAAY7G,YAAY,EAAE;UACjC;UACA,IACE6G,KAAK,CAACe,IAAI,KAAK7H,IAAI,CAAC8H,eAAe,IACnChB,KAAK,CAACe,IAAI,KAAK7H,IAAI,CAAC+H,QAAQ,IAC5BjB,KAAK,CAACe,IAAI,KAAK7H,IAAI,CAACgI,eAAe,EACnC;YACA,OAAO,IAAI9G,gBAAgB,CAAC;cAC1B8B,OAAO,EAAE,8CAA8C8D,KAAK,CAACe,IAAI,GAAG;cACpEf;aACD,CAAC;;;QAIN,OAAO,IAAI9F,oBAAoB,CAAC;UAC9BgC,OAAO,EAAE,oCAAoC;UAC7C8D;SACD,CAAC;MACJ,CAAC,CAAC;MAEF,OAAO;QAAES,UAAU;QAAEE;MAAM,CAAE;IAC/B,CAAC,CAAC,CACH;IAED,MAAMA,MAAM,GAAGrH,MAAM,CAAC6H,cAAc,CAAChB,MAAM,EAAE,CAACiB,KAAK,EAAEC,IAAI,KAAK3H,MAAM,CAAC4H,IAAI,CAAC,MAAMF,KAAK,CAACX,UAAU,CAACc,KAAK,CAACF,IAAI,CAAC,CAAC,CAAC,CAACjB,IAAI,CACjH9G,MAAM,CAACkI,OAAO,CAAEJ,KAAK,IAAKA,KAAK,CAACT,MAAM,CAAC,EACvCrH,MAAM,CAACmI,OAAO,CAAClG,OAAO,CAAC,EACvBjC,MAAM,CAACoI,GAAG,CAAEjG,QAAQ,IAAI;MACtB,IAAIA,QAAQ,CAACS,OAAO,CAACH,IAAI,KAAK,iBAAiB,EAAE;QAC/C,OAAOjC,GAAG,CAACgD,GAAG,CAAC1B,aAAa,EAAExB,MAAM,CAACyB,IAAI,CAACI,QAAQ,CAACS,OAAO,CAACD,KAAK,CAAC0F,MAAM,CAAC,CAAC;OAC1E,MAAM,IAAIlG,QAAQ,CAACS,OAAO,CAACH,IAAI,KAAK,iBAAiB,EAAE;QACtD,OAAOjC,GAAG,CAACgD,GAAG,CAAC1B,aAAa,EAAExB,MAAM,CAACyB,IAAI,CAACI,QAAQ,CAACS,OAAO,CAACD,KAAK,CAAC2F,eAAe,CAAC,CAAC;;MAGpF,OAAOlI,MAAM,CAACmI,IAAI;IACpB,CAAC,CAAC,EACFvI,MAAM,CAACwI,QAAQ,CAAEC,KAAK,IACpBrI,MAAM,CAACsI,GAAG,CAAC,CACTrI,MAAM,CAACwC,SAAS,CAAClC,OAAO,CAACgI,oBAAoB,CAAC,EAC9CvI,MAAM,CAACoG,UAAU,CAAC,yCAAyCP,MAAM,CAACwC,KAAK,CAAC,GAAG,CAAC,CAC7E,CAAC,CACH,CACF;IAED,OAAOpB,MAAM,CAACP,IAAI,CAChB9G,MAAM,CAAC4I,KAAK,CACVnI,QAAQ,CAACoI,WAAW,CAAC1I,QAAQ,CAAC2I,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAChC,IAAI;IAChD;IACArG,QAAQ,CAACsI,QAAQ;IACjB;IACAtI,QAAQ,CAACuI,MAAM,CAACvI,QAAQ,CAACwI,MAAM,CAAC9I,QAAQ,CAACkD,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC;IACtD;IACA5C,QAAQ,CAACyI,OAAO,CAACzI,QAAQ,CAAC0I,OAAO,CAAC;IAClC;IACA1I,QAAQ,CAAC2I,WAAW,CAACjJ,QAAQ,CAACkJ,iBAAiB,CAAClJ,QAAQ,CAACkD,OAAO,CAAC9B,eAAe,IAAI,GAAG,CAAC,CAAC,CAAC;IAC1F;IACAd,QAAQ,CAAC6I,UAAU,CAAC/I,SAAS,CAACgJ,QAAQ,CAAC,sBAAsB,CAAC,CAAC;IAC/D;IACA9I,QAAQ,CAAC+I,QAAQ,CAAC,MAAMpJ,MAAM,CAACoG,UAAU,CAAC,uCAAuC,CAAC,CAAC,CACpF,CACF,CACF;EACH,CAAC,CAAC;EAEF,OAAOxG,MAAM,CAACyJ,MAAM,CAACjI,MAAM,CAAC;AAC9B"}